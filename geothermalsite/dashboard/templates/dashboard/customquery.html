{% extends 'dashboard/base.html' %}
{% load static %}



{% block content %}
<link rel="stylesheet" href="{% static 'css/customquery.css' %}">
<body>
<div class="custom-query-container" id="custom-query-container" style="margin-left: 5%; margin-right: 5%">
    <h1>Advanced API: Custom Query</h1>
    <form method="post" id="custom-query-form">
        {% csrf_token %}
        <p>If you're looking to be able to access the database with a bit more freedom than the predefined queries provided,
            that option is provided here. You will need to know some SQL to get started, <u><a class="link" href="https://www.sqltutorial.org/" target="_blank">here's a good resource</a></u> if you've never
            used SQL before.</p>

        <p> Here is the schema diagram for the database </p>

        <label for="query">Enter A Custom Query:</label>
        <br>
        <textarea class="form-control" name="rawQuery" id="rawQuery" style="height: 10em; width: 80ch;">
            {% if form.initial %}
            {{ form.initial.rawQuery }}
            {% else %}{{ rawQuery }}
            {% endif %}
        </textarea>
        <br>

        {% if errorMessage %}
            <div class="alert alert-danger" role="alert" style="width: 80ch;">
                {{ errorMessage }}
            </div>
        {% endif %}

        <button class="btn btn-secondary form-control" data-toggle="modal" data-target="#exampleModal" type="submit" style="width: 80ch;">Submit</button>
    </form>

    <script>
        $('#exampleModal').on('shown.bs.modal', function () {
            $('#myInput').trigger('focus')
        })
    </script>

    {% if queryResults %}
        <p>Query Results:</p>
            <div>
                {% for row in queryResults|slice:":10" %}
                    <div>{{ row }}</div>
                {% endfor %}
            </div>
            {% if queryResults|length > 10 %}
                <details>
                    <summary>View all data</summary>
                    <div>
                        {% for row in queryResults %}
                            <div>{{ row }}</div>
                        {% endfor %}
                    </div>
                </details>
            {% endif %}
        
        <script src="{% static 'js/utils/createCsv.js' %}"></script>
        <script>
            var queryData = {{ queryResults | safe }};
        </script>
        <button class="btn btn-secondary form-control" onclick="downloadData('geothermal')" style="width: 80ch;">Download data </button>
    {% endif %}

{% endblock %}
</div>
</body>
